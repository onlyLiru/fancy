define("/WEB-UED/fancy/dist/p/userMessage/index",["/WEB-UED/fancy/dist/c/js/globale"],function(require,exports,module){var G=require("/WEB-UED/fancy/dist/c/js/globale"),main={init:function(){var self=this;self._event(),self._getMes()},_event:function(){var self=this,RegEx=/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/,RegEmail=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;$("#J-login-out").click(function(){$.ajax({type:"get",cach:!1,url:"/logout.do",success:function(res){if(1==res.info.ok){var isios=G._navigator().ios,isAndroid=G._navigator.android;isAndroid&&window.mall&&window.mall.removeToken?window.mall.removeToken():isios&&G.connectWebViewJavascriptBridge(function(bridge){bridge.send({logout:!0,globale:"logout"})}),location.href="/index.html"}else alert(res.info.message)},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})}),$("#save-loginid").unbind("click").bind("click",function(){var loginId=$("#loginid-input").val();return RegEx.test(loginId)?(self._edit({loginId:loginId}),void $.router.back("/customer/userMessage.html")):void $.alert("输入不合法")}),$("#save-nick-name").unbind("click").bind("click",function(){var name=$("#nick-name-input").val();return RegEx.test(name)?(self._edit({nickname:name}),void $.router.back("/customer/userMessage.html")):void $.alert("输入不合法")}),$("#save-email").unbind("click").bind("click",function(){var email=$("#email-input").val();return RegEmail.test(email)?(self._edit({email:email}),void $.router.back("/customer/userMessage.html")):void $.alert("邮箱不合法")}),$("#datetime-picker").calendar({inputReadOnly:!0,onClose:function(){var birth=$("#datetime-picker").val();self._edit({birthdayWeb:birth})}}),$("#edit-male").unbind().bind("click",function(){var buttons1=[{text:"请选择",label:!0},{text:"男",color:"warning",onClick:function(){$("#edit-male .item-after").text("男"),self._edit({sex:1})}},{text:"女",onClick:function(){$("#edit-male .item-after").text("女"),self._edit({sex:2})}}],buttons2=[{text:"取消",bg:"danger"}],groups=[buttons1,buttons2];$.actions(groups)})},_getMes:function(){var self=this;$.ajax({type:"get",cach:!1,url:"/customer/getCustomer.json",success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok?(self._setMes(res.data.customer),self.token=res.data.token):alert(res.info.message))},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})},_setMes:function(res){var self=this,loginId=res.loginId||"",nickname=res.nickname||"",sex=1==res.sex?"男":"女",mobile=res.mobile||'<a class="external" href="/login/register.do?target=/customer/customerMsg.html">还没有手机信息，请填写></a>',birthday=res.birthdayWeb||"",email=res.email||"";$("#mobile").html(mobile),$("#loginId").text(loginId),$("#loginid-input").val(loginId),$("#nickname").text(nickname),$("#nick-name-input").val(nickname),$("#email").text(email),$("#email-input").val(email),$("#sex").text(sex),$("#datetime-picker").val(birthday),self.customerId=res.customerId},_edit:function(data){var self=this;data=$.extend(data,{customerId:self.customerId,token:self.token}),$.ajax({type:"get",cach:!1,url:"/customer/updateCustomer.json",data:data,success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok?self._getMes():alert(res.info.message))},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})}};main.init()}),define("/WEB-UED/fancy/dist/c/js/globale",[],function(require,exports,module){var main={init:function(){var self=this;self._back()},_back:function(){var self=this;self._navigator().mobileWebKit&&$(".J-back").off().on("click",function(e){e.stopPropagation(),e.preventDefault(),window.history.go(-1)})},_getUrlParam:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null},_getLoginUser:function(callback){var loginUser;$.ajax({type:"get",cache:!1,url:"/login/getLoginUser.do",success:function(res){1==res.info.ok?(loginUser=res.data.loginUser,window.fancyLoginUser=loginUser,callback&&callback(loginUser)):alert(res.info.message)},beforeSend:function(){},complete:function(){},error:function(){}})},_getCartCount:function(userMes){userMes=userMes||window.fancyLoginUser,userMes&&$.ajax({type:"get",cache:!1,url:"/cart/countCart.json",success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok?res.data.count>0&&$("#J-cart-count").show().html(res.data.count):alert(res.info.message))},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})},_editCount:function(d){var box=$(d.box),defaultCount=d.defaultCount||1;box.html('<p class="edit-count color-gray">                <i class="iconfont J-cut">&#xe607;</i>                <span class="J-number">'+defaultCount+'</span>                <i class="iconfont J-add">&#xe608;</i>            </p>'),$(".J-cut").bind("click",function(){var curNum=parseInt($(this).parent().find(".J-number").text());1>=curNum||$(this).parent().find(".J-number").text(curNum-1)}),$(".J-add").bind("click",function(){var curNum=parseInt($(this).parent().find(".J-number").text());$(this).parent().find(".J-number").text(curNum+1)})},_navigator:function(){var u=navigator.userAgent;return{isWeixin:"micromessenger"==u.toLowerCase().match(/MicroMessenger/i),trident:u.indexOf("Trident")>-1,presto:u.indexOf("Presto")>-1,webKit:u.indexOf("AppleWebKit")>-1,gecko:u.indexOf("Gecko")>-1&&-1==u.indexOf("KHTML"),deskWebkit:-1==u.indexOf("Android")&&-1==u.indexOf("Mobile"),mobileWebKit:!!u.match(/AppleWebKit.*Mobile.*/)||!!u.match(/AppleWebKit/)||!!u.match(/.*Mobile.*/),ios:!!u.match(/(i[^;]+\;(U;)? CPU.+Mac OS X)/),android:u.indexOf("Android")>-1||u.indexOf("Linux")>-1,iPhone:u.indexOf("iPhone")>-1&&u.indexOf("Mac")>-1,iPad:u.indexOf("iPad")>-1,webApp:-1==u.indexOf("Safari")}},connectWebViewJavascriptBridge:function(callback){window.WebViewJavascriptBridge?callback(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){callback(WebViewJavascriptBridge)},!1)},_scroll:function(obj){var self=this;obj||(obj=$(".content")),$.config={showPageLoadingIndicator:!0},self._navigator().ios?self.scroller={type:"js"}:self.scroller={type:"auto"},obj.scroller(self.scroller)}};module.exports=main,main.init()});