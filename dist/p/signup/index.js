define("/WEB-UED/fancy/dist/p/signup/index",["/WEB-UED/fancy/dist/c/js/globale","/WEB-UED/fancy/dist/c/js/registerHelper","handlebars","/WEB-UED/fancy/dist/c/js/pingPay-activity","/WEB-UED/fancy/dist/p/signup/participator.handlebars"],function(require,exports,module){var G=require("/WEB-UED/fancy/dist/c/js/globale");require("/WEB-UED/fancy/dist/c/js/registerHelper");var ping=require("/WEB-UED/fancy/dist/c/js/pingPay-activity"),Tparticipator=require("/WEB-UED/fancy/dist/p/signup/participator.handlebars"),main={code:!1,init:function(){var self=main;self.activityId=G._getUrlParam("id"),self._getParticipator(),self._getSalMes(),self._event(),$(document).on("pageReinit",function(e,pageId,$page){"current-page"==pageId&&self._getPrice()}),$("#getCode").on("click",function(){self._getCode()}),window.fancyLoginUser&&window.fancyLoginUser.mobile&&$("#sign-phone").val(window.fancyLoginUser.mobile)},_getCode:function(){var self=this,code=$("#invitationCode").val();return code?(self.inviteCode=code,void $.ajax({type:"get",cach:!1,data:{inviteCode:code,activityId:self.activityId},url:"/activity/verifyInviteCode.json",success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok?($(".nav1").hide(),$(".nav2").show(),self.code=!0,$("#getCode").hide(),$.alert("成功！请添加活动成员")):$.alert(res.info.message))},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})):void $.alert("请输入邀请码")},_event:function(){var self=this;$(".J-confirm-pay").off().on("click",function(){var param=self._param();param&&self._sign(param)}),$("#add-save").off().on("click",function(){self._addPeople()}),$("#history-people li").off().on("click",function(e){e.stopPropagation(),e.preventDefault();var checkBox=$(this).find('input[type="checkbox"]'),isChecked=checkBox.is(":checked"),id=$(this).attr("data-id");isChecked?($('#join-people li[data-id="'+id+'"]').remove(),$('#history-people li[data-id="'+id+'"]').find('input[type="checkbox"]').prop("checked",!1)):self._addToJoin({checkbox:this})}),$('#history-people li i[rel="delete"]').off().on("click",function(e){e.stopPropagation(),e.preventDefault();var id=$(this).parents("li").attr("data-id");$.confirm("确定删除吗?",function(){self._delete(id)})}),$("#sign-safe").parent().off().on("click",function(){self._getPrice()}),$("#sign-code").parent().off().on("click",function(){var flag=$(this).find('input[type="checkbox"]').is(":checked");flag?$(".yaoqingCode").show():$(".yaoqingCode").hide()})},_getSalMes:function(){var self=this;$.ajax({type:"get",cach:!1,data:{activityId:self.activityId},url:"/activity/getSellInfo.json",success:function(res){if("noLogin"==res)return void(location.href="/login.do?target="+location.href);if(1==res.info.ok){var data=res.data.sellInfo,transportationType=data.transportationType||"",isInsurance=data.isInsurance||"",insurancePrice=data.insurancePrice||0;1==transportationType&&$(".transportationType").removeClass("hide"),1==isInsurance&&($("#sign-safe").parents(".item-input").append('<span class="price">￥<i class="insurancePrice">'+insurancePrice+"</i></span>"),$(".isInsurance").removeClass("hide"))}},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})},_getPrice:function(){var self=this,ids=[],data={activityId:self.activityId},signSafe=$("#sign-safe").is(":checked")?1:0;"1"==signSafe&&(data.isInsurance=signSafe,data.insurancePrice=$(".insurancePrice").text());var jpBox=$("#join-people");return jpBox.find("li").each(function(){ids.push($(this).attr("data-id"))}),ids.length<=0?void $("#J-totalPrice").html(" "):(data.participatorIds=ids.join(","),void $.ajax({type:"get",cach:!1,data:data,url:"/activity/getPrice.json",success:function(res){if("noLogin"==res)return void(location.href="/login.do?target="+location.href);if(1==res.info.ok){var price=res.data.price;$("#J-totalPrice").html('合计￥:<span class="price">'+price+"</span>")}},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}}))},_getParticipator:function(){var self=this;$.ajax({type:"get",cach:!1,url:"/activity/listParticipator.json",success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok&&($("#history-people").html(Tparticipator(res.data.participatorList)),$("#join-people li").each(function(){var id=$(this).attr("data-id"),checkbox=$('#history-people li[data-id="'+id+'"]').find('input[type="checkbox"]');checkbox.prop("checked",!0)}),self._event()))},beforeSend:function(){},complete:function(){},error:function(){}})},_addPeople:function(){var self=this,mobileReg=/^1[3|4|5|7|8][0-9]\d{4,8}$/,addParam={},addName=$("#add-name").val(),addPhone=$("#add-phone").val(),addAge=$("#add-age").val(),sex=$("#add-sex").val();return addName?addAge?addPhone&&!mobileReg.test(addPhone)?void $.alert("手机号填写错误"):(addParam={realName:addName,age:addAge,mobile:addPhone,sex:sex},void self._canAdd(addParam)):void $.alert("请填写年龄"):void $.alert("请填写参加人姓名")},_canAdd:function(data){var self=this;$.ajax({type:"get",cach:!1,data:data,url:"/activity/addParticipator.json",success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok&&(self._getParticipator(),$.router.back(),$("#add-people input").val("")))},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})},_delete:function(id){var self=this;$('#join-people li[data-id="'+id+'"]').remove(),$.ajax({type:"get",cach:!1,data:{participatorId:id},url:"/activity/delParticipator.json",success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok&&self._getParticipator())},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})},_addToJoin:function(param){var self=this,$li=$(param.checkbox),name=$li.find("span[rel=name]").html(),phone=$li.find("div[rel=phone]").text(),id=$li.attr("data-id");$("#join-people ul").prepend('<li data-id="'+id+'">                <a href="#" class="item-content">                  <div class="item-inner">                    <div class="item-title-row">                        <div class="item-title fz22"> '+name+' </div>                    </div>                    <div class="color-gray">'+phone+"</div>                  </div>                </a>              </li>"),$('#history-people li[data-id="'+id+'"]').find('input[type="checkbox"]').prop("checked",!0),self._event()},_param:function(){var activityId=G._getUrlParam("id")||"",mobileReg=/^1[3|4|5|7|8][0-9]\d{4,8}$/,signParam={},signName=$("#sign-name").val(),signPhone=$("#sign-phone").val(),signTraffick=$("#sign-traffick").val(),signSafe=$("#sign-safe").is(":checked")?1:0,price=$("#J-totalPrice .price").text(),ids=[];if(!signName)return void $.alert("请填写报名人姓名");if(!mobileReg.test(signPhone))return void $.alert("手机号填写错误");var jpBox=$("#join-people");return jpBox.find("li").each(function(){ids.push($(this).attr("data-id"))}),ids.length<=0?void $.alert("请添加参与人"):(ids=ids.join(","),signParam={realName:signName,mobile:signPhone,price:price,participatorIds:ids,activityId:activityId},$(".transportationType").hasClass("hide")||(signParam.transportationType=signTraffick),$(".isInsurance").hasClass("hide")||(signParam.isInsurance=signSafe),"1"==signSafe&&(signParam.insurancePrice=$(".insurancePrice").text()),signParam)},_sign:function(data){var self=this;self.code&&(data.isUseCode=1,data.inviteCode=self.inviteCode),$.ajax({type:"get",cach:!1,data:data,url:"/activity/jsonSignup.json",success:function(res){if("noLogin"==res)return void(location.href="/login.do?target="+location.href);if(1==res.info.ok)if(self.code){var from=$("#J-from").val(),href="/activity/myActivity.html";"fsl"==from&&(href="/"+href),window.location.href=href}else{var orderNo=res.data.orderNo;ping.init(orderNo,"acitvity")}},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})}};main.init()}),define("/WEB-UED/fancy/dist/c/js/globale",[],function(require,exports,module){var main={init:function(){var self=this;self._back()},_back:function(){var self=this;self._navigator().mobileWebKit&&$(".J-back").off().on("click",function(e){e.stopPropagation(),e.preventDefault(),window.history.go(-1)})},_getUrlParam:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null},_getLoginUser:function(callback){var loginUser;$.ajax({type:"get",cache:!1,url:"/login/getLoginUser.do",success:function(res){1==res.info.ok?(loginUser=res.data.loginUser,window.fancyLoginUser=loginUser,callback&&callback(loginUser)):alert(res.info.message)},beforeSend:function(){},complete:function(){},error:function(){}})},_getCartCount:function(userMes){userMes=userMes||window.fancyLoginUser,userMes&&$.ajax({type:"get",cache:!1,url:"/cart/countCart.json",success:function(res){return"noLogin"==res?void(location.href="/login.do?target="+location.href):void(1==res.info.ok?res.data.count>0&&$("#J-cart-count").show().html(res.data.count):alert(res.info.message))},beforeSend:function(){$.showIndicator()},complete:function(){$.hideIndicator()},error:function(){}})},_editCount:function(d){var box=$(d.box),defaultCount=d.defaultCount||1;box.html('<p class="edit-count color-gray">                <i class="iconfont J-cut">&#xe607;</i>                <span class="J-number">'+defaultCount+'</span>                <i class="iconfont J-add">&#xe608;</i>            </p>'),$(".J-cut").bind("click",function(){var curNum=parseInt($(this).parent().find(".J-number").text());1>=curNum||$(this).parent().find(".J-number").text(curNum-1)}),$(".J-add").bind("click",function(){var curNum=parseInt($(this).parent().find(".J-number").text());$(this).parent().find(".J-number").text(curNum+1)})},_navigator:function(){var u=navigator.userAgent;return{isWeixin:"micromessenger"==u.toLowerCase().match(/MicroMessenger/i),trident:u.indexOf("Trident")>-1,presto:u.indexOf("Presto")>-1,webKit:u.indexOf("AppleWebKit")>-1,gecko:u.indexOf("Gecko")>-1&&-1==u.indexOf("KHTML"),deskWebkit:-1==u.indexOf("Android")&&-1==u.indexOf("Mobile"),mobileWebKit:!!u.match(/AppleWebKit.*Mobile.*/)||!!u.match(/AppleWebKit/)||!!u.match(/.*Mobile.*/),ios:!!u.match(/(i[^;]+\;(U;)? CPU.+Mac OS X)/),android:u.indexOf("Android")>-1||u.indexOf("Linux")>-1,iPhone:u.indexOf("iPhone")>-1&&u.indexOf("Mac")>-1,iPad:u.indexOf("iPad")>-1,webApp:-1==u.indexOf("Safari")}},connectWebViewJavascriptBridge:function(callback){window.WebViewJavascriptBridge?callback(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){callback(WebViewJavascriptBridge)},!1)},_scroll:function(obj){var self=this;obj||(obj=$(".content")),$.config={showPageLoadingIndicator:!0},self._navigator().ios?self.scroller={type:"js"}:self.scroller={type:"auto"},obj.scroller(self.scroller)}};module.exports=main,main.init()}),define("/WEB-UED/fancy/dist/c/js/registerHelper",["handlebars"],function(require,exports,module){var Handlebars=require("handlebars");Handlebars.registerHelper("ifCond",function(v1,operator,v2,options){switch(operator){case"!=":return v1!=v2?options.fn(this):options.inverse(this);case"==":return v1==v2?options.fn(this):options.inverse(this);case"===":return v1===v2?options.fn(this):options.inverse(this);case"<":return v2>v1?options.fn(this):options.inverse(this);case"<=":return v2>=v1?options.fn(this):options.inverse(this);case">":return v1>v2?options.fn(this):options.inverse(this);case">=":return v1>=v2?options.fn(this):options.inverse(this);case"&&":return v1&&v2?options.fn(this):options.inverse(this);case"||":return v1||v2?options.fn(this):options.inverse(this);default:return options.inverse(this)}})}),define("/WEB-UED/fancy/dist/c/js/pingPay-activity",[],function(require,exports,module){var main={init:function(orderNo){var amount=100*$("#J-totalPrice .J-total").text()||"",$openId=$("#J-openId"),openId=$openId.val();openId&&!sessionStorage.openId&&(sessionStorage.openId=openId),window.sessionStorage&&(openId=openId||sessionStorage.openId),orderNo&&(sessionStorage.orderNo=orderNo);var param={openId:openId,orderNo:orderNo};pingpp_one.init({app_id:"app_arzrzD1SWX9CbzTO",amount:amount,channel:["wx_pub","alipay_wap"],charge_url:"/payment/getCharge.json",charge_param:param,open_id:openId,debug:!1},function(res){res.debug&&res.chargeUrlOutput&&console.log(res.chargeUrlOutput),res.status?res.debug&&!res.wxSuccess?confirm("当前为 debug 模式，是否继续支付？")&&pingpp_one.resume():pingpp_one.success(function(res){res.status||alert(res.msg)},function(){window.location.href="/activity/myActivity.html"}):alert(res.msg)});var timer=setInterval(function(){$("body").hasClass("p_one_open")&&(clearInterval(timer),$("body").removeClass("p_one_open"))},10)},randomString:function(len){len=len||32;var chars="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",maxPos=chars.length,pwd="";for(i=0;i<len;i++)pwd+=chars.charAt(Math.floor(Math.random()*maxPos));return pwd}};module.exports=main}),define("/WEB-UED/fancy/dist/p/signup/participator.handlebars",["alinw/handlebars/1.3.0/runtime"],function(require,exports,module){var Handlebars=require("alinw/handlebars/1.3.0/runtime"),template=Handlebars.template;module.exports=template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+="\r\n  <li data-id=",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'>\r\n    <label class="label-checkbox item-content">\r\n      <input type="checkbox" name="my-checkbox" data-type="0">\r\n      <div class="item-media"><i class="icon icon-form-checkbox"></i></div>\r\n      <div class="item-inner">\r\n        <div class="item-title-row">\r\n          <div class="item-title fz22">\r\n            <span rel="name">',(helper=helpers.realName)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.realName,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\r\n              ",helper=helpers.ifCond||depth0&&depth0.ifCond,options={hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data},stack1=helper?helper.call(depth0,depth0&&depth0.sex,"==",1,options):helperMissing.call(depth0,"ifCond",depth0&&depth0.sex,"==",1,options),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n              ",helper=helpers.ifCond||depth0&&depth0.ifCond,options={hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data},stack1=helper?helper.call(depth0,depth0&&depth0.sex,"==",2,options):helperMissing.call(depth0,"ifCond",depth0&&depth0.sex,"==",2,options),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\r\n              <span class="fz14 color-gray">\r\n                ',stack1=helpers["if"].call(depth0,depth0&&depth0.age,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\r\n              </span>\r\n            </span>\r\n          </div>\r\n          <div class="item-after">\r\n            <i class="color-orange iconfont" rel="delete">&#xe602;</i>\r\n          </div>\r\n        </div>\r\n        <div class="color-gray" rel="phone">',(helper=helpers.mobile)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mobile,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>\r\n      </div>\r\n    </label>\r\n  </li>\r\n"}function program2(depth0,data){return"\r\n                (男)\r\n              "}function program4(depth0,data){return"\r\n                (女)\r\n              "}function program6(depth0,data){var stack1,helper,buffer="";return buffer+="\r\n                  ",(helper=helpers.age)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.age,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"岁\r\n                "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+="<ul>\r\n",stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n</ul>"})});