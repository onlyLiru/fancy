define("alinw/upload/2.0.5/upload",["$","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","./form.handlebars","./blank-iframe.handlebars","./another-iframe.handlebars","./data-input.handlebars","arale/detector/1.3.0/detector"],function(a,b,c){"use strict";var d=a("$"),e=a("arale/base/1.1.1/base"),f=a("./form.handlebars"),g=a("./blank-iframe.handlebars"),h=a("./another-iframe.handlebars"),i=a("./data-input.handlebars"),j=a("arale/detector/1.3.0/detector"),k=0,l=window,m=d("body:first"),n=l.FormData?!0:!1,o=e.extend({attrs:{trigger:null,name:null,action:null,accept:null,multiple:!1,data:{},error:null,success:null,change:null,progress:null,form:null,iframe:null,input:null,files:[],runner:null},initialize:function(a){var b=this;o.superclass.initialize.call(b,a),b.get("trigger")instanceof d||b.set("trigger",d(b.get("trigger"))),b.setup(),b.bindEvents()},setup:function(){var a=this,b=a.get("trigger");a.set("iframe",a.newIframe());var c=function(){return{top:b.offset().top+"px",left:b.offset().left+"px",width:b.outerWidth()+"px",height:b.outerHeight()+"px",zIndex:a.getZIndex(b)+10}};return a.set("form",d(f({target:a.get("iframe").attr("name"),option:{action:a.get("action"),name:a.get("name"),accept:a.get("accept"),multiple:a.get("multiple")},data:d.map(a.get("data"),function(a,b){return{name:b,value:a}}),isSupportFormData:n,formStyles:c(),fileInput:{height:b.outerHeight()+"px",fontSize:Math.max(64,5*b.outerHeight())}})).appendTo(m)),a.set("input",a.get("form").find("input[type=file]:last").attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:b.outerHeight()})),a.get("input").attr("id","input-"+Math.random()),j.browser.ie&&j.browser.version<=8?setInterval(function(){a.get("form").css(c())},500):d(document.body).on("DOMSubtreeModified",function(b){var e=d(b.target),f=e.find("img").length>0||e.find("iframe").length>0;f?d.each(["img","iframe"],function(b,d){e.find(d).on("load",function(){a.get("form").css(c())})}):a.get("form").css(c())}),a},bindEvents:function(){var a=this;a.bindEventsForInput()},bindEventsForInput:function(){var a=this,b=null;n?a.get("input").on("change",function(b){a.set("files",this.files||[{name:b.currentTarget.value}]);var c=b.currentTarget.value;d.isFunction(a.get("change"))?a.get("change").call(a,a.get("files")):c&&a.submit()}):(a.get("input").on("click",function(){b=null,a.get("input").val("")}),a.get("runner")&&l.clearInterval(a.get("runner")),a.set("runner",l.setInterval(function(){var c=a.get("input").val();c!==b&&c.length>0&&(a.set("files",this.files||[{name:c}]),d.isFunction(a.get("change"))?a.get("change").call(a,a.get("files")):c&&a.submit()),b=c},300)))},submit:function(){var a=this;if(n&&a.get("files")){var b=new l.FormData(a.get("form").get(0));b.append(a.get("name"),a.get("files"));var c=null;if("function"==typeof a.get("progress")){var e=a.get("files");c=function(){var b=d.ajaxSettings.xhr();return b.upload&&b.upload.addEventListener("progress",function(b){var c=0,d=b.loaded||b.position,f=b.total;b.lengthComputable&&(c=Math.ceil(100*(d/f))),a.get("progress")(b,d,f,c,e)},!1),b}}return d.ajax({url:a.get("action"),type:"POST",processData:!1,contentType:!1,data:b,xhr:c,context:this,success:a.get("success"),error:a.get("error"),complete:function(){a.get("input")instanceof d&&a.get("input").val("")}}),a}return a.set("iframe",a.newIframe()),a.get("form").attr("target",a.get("iframe").attr("name")),m.append(a.get("iframe")),a.get("iframe").one("load",function(){var b=d(this);d(h({})).appendTo(a.get("form")).remove();var c=b.contents().find("body:first").text();b.remove(),c?d.isFunction(a.get("success"))&&a.get("success")(c):d.isFunction(a.get("error"))&&a.get("error")(a.get("input").val())}),a.get("form").submit(),a},enable:function(){var a=this;a.get("input")instanceof d&&a.get("input").prop("disabled",!1)},disable:function(){var a=this;a.get("input")instanceof d&&a.get("input").prop("disabled",!0)},newIframe:function(){var a=d(g({id:k})).hide();return k+=1,a},getZIndex:function(a){var b=0;return a.parentsUntil("body").each(function(){var a=d(this);"static"!==a.css("position")&&(b=parseInt(a.css("zIndex"),10)||b)}),b},createDataInput:function(a){return i(a)}});c.exports=o}),define("alinw/upload/2.0.5/form.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n        <input type="hidden" name="',(d=c.name)?d=d.call(a,{hash:{},data:b}):(d=a.name,d=typeof d===o?d.apply(a):d),e+=p(d)+'" value="',(d=c.value)?d=d.call(a,{hash:{},data:b}):(d=a.value,d=typeof d===o?d.apply(a):d),e+=p(d)+'" />\n    '}function g(){return'\n        <input type="hidden" name="_uploader_" value="formdata" />\n    '}function h(){return'\n        <input type="hidden" name="_uploader_" value="iframe" />\n    '}function i(a){var b,c="";return c+='accept="'+p((b=a.option,b=null==b||b===!1?b:b.accept,typeof b===o?b.apply(a):b))+'" '}function j(){return'multiple="multiple"'}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var k in a.helpers)c[k]=c[k]||a.helpers[k];e=e||{};var l,m,n="",o="function",p=this.escapeExpression,q=this;return n+='\n\n\n\n\n\n<form method="POST" enctype="multipart/form-data" target="',(l=c.target)?l=l.call(b,{hash:{},data:e}):(l=b.target,l=typeof l===o?l.apply(b):l),n+=p(l)+'" action="'+p((l=b.option,l=null==l||l===!1?l:l.action,typeof l===o?l.apply(b):l))+'" style="position:absolute;top: '+p((l=b.formStyles,l=null==l||l===!1?l:l.top,typeof l===o?l.apply(b):l))+";left: "+p((l=b.formStyles,l=null==l||l===!1?l:l.left,typeof l===o?l.apply(b):l))+";overflow: hidden;width: "+p((l=b.formStyles,l=null==l||l===!1?l:l.width,typeof l===o?l.apply(b):l))+"; height: "+p((l=b.formStyles,l=null==l||l===!1?l:l.height,typeof l===o?l.apply(b):l))+";z-index: "+p((l=b.formStyles,l=null==l||l===!1?l:l.zIndex,typeof l===o?l.apply(b):l))+'">\n    ',m=c.each.call(b,b.data,{hash:{},inverse:q.noop,fn:q.program(1,f,e),data:e}),(m||0===m)&&(n+=m),n+="\n    ",m=c["if"].call(b,b.isSupportFormData,{hash:{},inverse:q.program(5,h,e),fn:q.program(3,g,e),data:e}),(m||0===m)&&(n+=m),n+='\n    <input type="file" name="'+p((l=b.option,l=null==l||l===!1?l:l.name,typeof l===o?l.apply(b):l))+'" ',m=c["if"].call(b,(l=b.option,null==l||l===!1?l:l.accept),{hash:{},inverse:q.noop,fn:q.program(7,i,e),data:e}),(m||0===m)&&(n+=m),n+=" ",m=c["if"].call(b,(l=b.option,null==l||l===!1?l:l.multiple),{hash:{},inverse:q.noop,fn:q.program(9,j,e),data:e}),(m||0===m)&&(n+=m),n+=" />\n</form>"})}),define("alinw/upload/2.0.5/blank-iframe.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var f in a.helpers)c[f]=c[f]||a.helpers[f];e=e||{};var g,h="",i="function",j=this.escapeExpression;return h+='\n\n\n\n\n\n<iframe name="iframe-uploader-',(g=c.id)?g=g.call(b,{hash:{},data:e}):(g=b.id,g=typeof g===i?g.apply(b):g),h+=j(g)+'">\n</iframe>'})}),define("alinw/upload/2.0.5/another-iframe.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var f in a.helpers)c[f]=c[f]||a.helpers[f];e=e||{};var g="";return g+='\n\n\n\n\n<iframe src="javascript:false;"></iframe>'})}),define("alinw/upload/2.0.5/data-input.handlebars",["gallery/handlebars/1.0.2/runtime"],function(a,b,c){var d=a("gallery/handlebars/1.0.2/runtime"),e=d.template;c.exports=e(function(a,b,c,d,e){function f(a,b){var d;return(d=c.type)?d=d.call(a,{hash:{},data:b}):(d=a.type,d=typeof d===k?d.apply(a):d),l(d)}function g(){return"hidden"}this.compilerInfo=[3,">= 1.0.0-rc.4"],c=c||{};for(var h in a.helpers)c[h]=c[h]||a.helpers[h];e=e||{};var i,j="",k="function",l=this.escapeExpression,m=this;return j+='\n\n\n\n\n\n<input type="',i=c["if"].call(b,b.type,{hash:{},inverse:m.program(3,g,e),fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+='" name="',(i=c.name)?i=i.call(b,{hash:{},data:e}):(i=b.name,i=typeof i===k?i.apply(b):i),j+=l(i)+'" value="',(i=c.value)?i=i.call(b,{hash:{},data:e}):(i=b.value,i=typeof i===k?i.apply(b):i),j+=l(i)+'" />'})});
